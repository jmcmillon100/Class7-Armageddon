Lab 4A ‚Äî Japan Medical
AWS ‚Üî GCP Secure Connectivity (IPSec VPN + BGP)

üéØ Lab Objective
In this lab, you will design and validate secure, compliant connectivity between:
    AWS Tokyo (ap-northeast-1) ‚Äî authoritative data region
    GCP Iowa (us-central1) ‚Äî New York branch compute (GCP side)

using:
    IPSec VPN
    BGP for dynamic routing
    No databases outside Japan
    Strict process discipline

This lab focuses on how regulated organizations connect clouds safely, not on ‚Äúfastest possible networking.‚Äù

üß† Why This Lab Exists (Reality Check)
In real enterprises:
    Not all branches use the same cloud
    Not all teams report to the same platform group
    Legal obligations override technical preference
    Connectivity requires coordination, not heroics

This lab simulates a real multi-team, multi-provider connection where mistakes have consequences.

üåç Architecture Overview
Regions
    AWS: Tokyo (ap-northeast-1)
    GCP: Iowa (us-central1)

Roles
  AWS Tokyo
    RDS (PHI lives here only)
    Transit Gateway (hub)
    VPN termination (TGW VPN attachment)

  GCP Iowa
    VMs only (no databases)
    Network Connectivity Center (NCC)
    Cloud VPN (HA VPN)
    Cloud Router (BGP)

üîó Connectivity Model
Technology Used
    IPSec VPN (site-to-site)
    BGP for dynamic route exchange
    Private IP routing only
    Encrypted in transit

BGP Link-Local Ranges (Given)
You must use the following BGP IP ranges:
  169.254.12.0/30
  169.254.12.4/30

These are link-local and used only inside the tunnel.

üîê Security & Compliance Constraints (Non-Negotiable)
    No PHI stored in GCP
    No databases in GCP
    No disk persistence of medical data
    No logging of PHI
    All traffic encrypted
    All routing explicit and auditable

If a solution ‚Äúworks‚Äù but violates these rules, it fails the lab.

üß© What Each Side Is Responsible For
AWS Tokyo Team (You)
    Create Transit Gateway VPN attachment
    Configure BGP ASN and peers
    Advertise only Tokyo VPC CIDR
    Accept routes from GCP
    Ensure return routing is correct
    Keep PHI inside Japan

GCP Iowa Team (You)
    Create HA VPN gateway
    Create Cloud Router (BGP enabled)
    Integrate with Network Connectivity Center
    Configure BGP peers with AWS
    Advertise only GCP VPC CIDR
    Ensure no data persistence

üîë Process Reminder: Pre-Shared Keys (PSKs)
This Is Important
In real environments:
    --> Pre-Shared Keys are never sent over chat, screenshots, or tickets.

For this lab:
    Each VPN tunnel uses a PSK
    PSKs must be:
      Generated securely
      Stored temporarily
      Shared out-of-band

Acceptable Methods (Lab Simulation)
    Password manager entry
    Secure note shared verbally
    Encrypted file (temporary)
    One-time secure message

Not Acceptable
    Slack / Teams plaintext
    Email
    Hard-coding in Terraform repos
    Screenshots

üìå Process discipline is part of the grade.

üîß High-Level Build Steps (No Code Yet)
Step 1 ‚Äî AWS Tokyo
    Confirm Transit Gateway exists
    Create Site-to-Site VPN attached to TGW
    Enable dynamic routing (BGP)
    Configure:
      Local ASN (AWS side)
      BGP peer IPs (169.254.12.x)
      Two tunnels for HA
    Export:
      Tunnel outside IPs
      BGP inside IPs
      ASN
      PSKs

Step 2 ‚Äî GCP Iowa
    Create HA VPN gateway
    Create Cloud Router
    Enable BGP
    Configure:
      Peer ASN
      Link-local IPs
      Matching PSKs
    Attach VPN to Network Connectivity Center
    Advertise GCP VPC CIDR

Step 3 ‚Äî Routing Validation
    Confirm:
      AWS sees GCP routes
      GCP sees Tokyo routes
      No extra CIDRs exchanged

‚úÖ What Students Must Prove (Deliverables)
üì¶ Deliverable 1 ‚Äî Connectivity Evidence
Submit screenshots or CLI output showing:
    BGP session Established
    Routes learned on both sides
    Only approved CIDRs exchanged

üì¶ Deliverable 2 ‚Äî Network Diagram
A simple diagram showing:
    AWS TGW
    VPN tunnels
    GCP HA VPN
    Cloud Router
    CIDR flow direction

Clarity > artwork.

üì¶ Deliverable 3 ‚Äî Process Write-Up (Short)
Answer in 6‚Äì10 sentences:
    How PSKs were generated
    How they were shared
    Why this matters in regulated environments

üì¶ Deliverable 4 ‚Äî Compliance Statement
One paragraph explaining:
    Why no data is stored in GCP
    Why this satisfies Japanese privacy requirements
    Why ‚Äúmulti-cloud‚Äù does not mean ‚Äúmulti-storage‚Äù

üéì Why This Lab Matters for Your Career
This lab teaches you to:
    Work across providers
    Coordinate between teams
    Respect legal boundaries
    Treat networking as shared responsibility
    Value process as much as code

Many engineers can configure VPNs.
Few can do it cleanly, safely, and defensibly.
      
üó£Ô∏è Interview Talk Track (Practice This)

  ‚ÄúWe connected a GCP-based medical branch to AWS using IPSec VPN and BGP, while ensuring all PHI remained in Japan.
  The GCP side ran compute only, and routing was tightly controlled to meet compliance requirements.‚Äù

That answer signals real-world readiness.
        
üß† One Sentence to Remember
Secure connectivity is as much about process as it is about packets.


What you‚Äôre getting below (GCP / Iowa us-central1):
        VPC + subnet (placeholders for 10.x.x.x/xx)
        Firewall rules so the HTTPS URL is ONLY reachable from VPN/TGW CIDRs
        Managed Instance Group (MIG) behind an Internal HTTPS Load Balancer (so it‚Äôs only reachable over VPN)
        Self-signed cert generated at boot on each VM (simple)
        Startup script that:
                installs Nginx + Python
                hosts a tiny internal app endpoint
                includes a basic ‚Äúwrite/read to Tokyo RDS‚Äù Python test script (students wire the DB params)
            Optional: Cloud NAT (so instances can apt-get without making the service public)
        This assumes AWS‚ÜîGCP VPN/BGP (Lab 4A) already exists and routes are working.

Lab 4A-2 ‚Äî GCP MIG ‚ÄúNY Branch‚Äù (Compute Only) + Private HTTPS + Tokyo RDS Access
What changes from AWS Lab 2

        1) In GCP, you do not use CloudFront as the entrypoint here.
                --> This ‚ÄúNY branch‚Äù app is private-only: reachable via VPN/TGW only.
        2) The VM/MIG must connect to Tokyo RDS across the VPN corridor.
        3) No DB resources in GCP. Ever.

Terraform Skeleton (GCP)

Naming convention suggestion for NY Japanese-town flavor: nihonmachi-* (NY branch ‚ÄúJapan Town‚Äù)
Region: us-central1 (Iowa)

providers.tf
variables.tf
network.tf
Optional: Cloud NAT (so instances can install packages without being public)
nat.tf (optional but recommended)
Firewall: allow HTTPS only from VPN/TGW, and allow health checks internally
firewall.tf
Service account + Secret access (password not in TF state)
iam.tf
Instance template with self-signed HTTPS + tiny app + Tokyo RDS test script
compute.tf
Internal HTTPS Load Balancer (private URL over VPN only)
ilb.tf
startup.sh.tftpl (VM bootstrap)
Create a file named startup.sh.tftpl:

How Students Verify It (Deliverables)
Deliverable 1 ‚Äî Private-only access proof
        Show that the internal LB IP works from inside VPN only
        Show it does not work from the public internet

Commands:

        gcloud compute forwarding-rules describe nihonmachi-fr01 --region us-central1


From a host inside the VPN corridor:

        curl -k https://<INTERNAL_LB_IP>/health
        curl -k https://<INTERNAL_LB_IP>/

Deliverable 2 ‚Äî MIG proof

        gcloud compute instance-groups managed list --regions us-central1
        gcloud compute instances list --filter="name~nihonmachi-app"

Deliverable 3 ‚Äî Tokyo RDS connectivity proo
From the VM (SSH via IAP or internal bastion), run:

        source /etc/profile.d/tokyo_rds.sh
        python3 /usr/local/bin/rds_test.py

You submit the JSON output.
Deliverable 4 ‚Äî Process proof (PSK discipline reminder)
Students must write 6‚Äì10 lines:
        how PSKs were generated and shared (out-of-band)
        why secrets must not go in Terraform state
        what would be considered a compliance mistake (PHI in logs, local DB, etc.)

Restrictions reminders (repeat to them)
        No databases in GCP
        No PHI in logs.
        Only private access over VPN corridor.
        Passwords/secrets must not be hardcoded in TF or Git.





