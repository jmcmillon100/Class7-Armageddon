Lab 3B — Japan Medical
Audit Evidence & Regulator-Ready Logging (APPI mindset)

🎯 Objective
このラボで学生が作るのは「システム」ではなく 証明（proof）。
  PHI は東京（ap-northeast-1）にのみ保存（APPIの考え方） 
  São Paulo（sa-east-1）は 計算（compute）だけ
  監査人に見せられる形で「誰が・いつ・何を・どこに」したかを証跡として出せるようにする
  CloudFront/WAF/CloudTrail/ログを “一つの証拠パック” にまとめる
  美人をナンパ

🧠 The Compliance-Audit Principle
規制業界では「動いてる」より「証明できる」が勝つ。
そして Global access ≠ Global storage。

What “Good Evidence” Looks Like (What auditors actually want)
監査・法務・セキュリティが欲しいのは、だいたいこの 6 点です：
  1. Data Residency proof
    RDS が Tokyo にあること
    クロスリージョンに DB が無いこと
    
  2. Access trail
    誰が API を叩いたか（個人情報は含めない）
    
  3. Change trail
    誰がセキュリティ設定を変えたか（CloudTrail）
    
  4. Network corridor proof
    São Paulo → Tokyo の経路が TGW であること
    
  5. Edge security proof
    CloudFront + WAF が前段にあり、直ALBが閉じていること
    
  6. Retention / immutability posture
    監査ログは改ざんされない場所に保存されること（S3 + バージョニング等）

Required Services (Lab 3B control plane)
1) CloudTrail (Change evidence)
    CloudTrail Event History は 管理イベントを90日見られる（デフォルトで利用可） 
    さらに「Trail」を作ると S3 に長期保管が可能
    CloudTrail は management events / data events / insights など種類がある（デフォルトは管理イベント） 

Lab要求：Tokyo と São Paulo の両方で “証跡” を取れること（少なくとも管理イベント）。

2) CloudFront logs (Edge access evidence)
    CloudFront standard logs は viewer request を記録 
    x-edge-result-type で Hit/Miss/RefreshHit が証明できる 

Lab要求：
監査パックに「直ALBが閉じていて CloudFront 経由のみ」であることを示す evidence を入れる

3) WAF logs (Security evidence)
    WAFログは Firehose に送れるし、CloudWatch Logs / S3 へも送れる 
    SIEMに送るなら Firehose が現場的 

Lab要求：WAF の Allow/Block を証明できるログ or 集計

4) VPC Flow Logs / TGW path evidence (Network corridor proof)
    （ここは“設計の正しさ”を証拠化するパート）
    Flow Logs を使う場合：PHIを含まないメタデータとして扱える
    TGW ルートやアタッチメントの存在は CLI で証明できる

    

